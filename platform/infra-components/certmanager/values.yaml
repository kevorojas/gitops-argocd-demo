# Cert-Manager Helm Chart Values v1.19.2
# Referencia: https://artifacthub.io/packages/helm/cert-manager/cert-manager

# Configuración global
global:
  priorityClassName: ""
  rbac:
    create: true
    aggregateClusterRoles: true
  podSecurityPolicy:
    enabled: false
    useAppArmor: true
  logLevel: 2
  leaderElection:
    namespace: "kube-system"
  nodeSelector: {}
  imagePullSecrets: []

# Instalar CRDs (nuevo schema)
crds:
  enabled: true
  keep: true

# Configuración principal del controlador cert-manager
replicaCount: 1

# Estrategia de deployment
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 0
    maxUnavailable: 1

# Configuración de la imagen (nuevo formato)
image:
  registry: quay.io
  repository: jetstack/cert-manager-controller
  # tag: se usa la versión del chart
  pullPolicy: IfNotPresent

# Configuración de ServiceAccount
serviceAccount:
  create: true
  name: ""
  annotations: {}
  automountServiceAccountToken: true

# Configuración de recursos
resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 10m
    memory: 32Mi

# Security Context (nuevo schema)
securityContext:
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

# Configuración de nodos
nodeSelector:
  kubernetes.io/os: linux
tolerations: []
affinity: {}

# Configuración de DNS para ACME DNS01
dns01RecursiveNameservers: "8.8.8.8:53,1.1.1.1:53"
dns01RecursiveNameserversOnly: false

# Configuración de métricas (actualizada)
prometheus:
  enabled: true
  servicemonitor:
    enabled: false
    prometheusInstance: default
    targetPort: 9402
    path: /metrics
    interval: 60s
    scrapeTimeout: 30s
    labels: {}
    annotations: {}
    endpointAdditionalProperties: {}
  podmonitor:
    enabled: false
    prometheusInstance: default
    path: /metrics
    interval: 60s
    scrapeTimeout: 30s
    labels: {}
    annotations: {}
    endpointAdditionalProperties: {}

# Configuración del webhook (schema actualizado)
webhook:
  replicaCount: 1
  timeoutSeconds: 30
  
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  
  image:
    registry: quay.io
    repository: jetstack/cert-manager-webhook
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 32Mi
  
  securityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
  
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true
  
  hostNetwork: false
  serviceType: ClusterIP
  securePort: 10250
  
  # Configuración de Service Account para webhook
  serviceAccount:
    create: true
    name: ""
    annotations: {}
    automountServiceAccountToken: true

# Configuración del CA Injector (schema actualizado)
cainjector:
  enabled: true
  replicaCount: 1
  
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  
  image:
    registry: quay.io
    repository: jetstack/cert-manager-cainjector
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 32Mi
  
  securityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
  
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true
  
  # Configuración de Service Account para cainjector
  serviceAccount:
    create: true
    name: ""
    annotations: {}
    automountServiceAccountToken: true

# Configuración de startup API check (schema actualizado)
startupapicheck:
  enabled: true
  
  # Configuración de timeout
  timeout: 1m
  
  # Configuración de backoff
  backoffLimit: 4
  
  # Configuración de Job
  jobAnnotations:
    helm.sh/hook: post-install
    helm.sh/hook-weight: "1"
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
  
  image:
    registry: quay.io
    repository: jetstack/cert-manager-startupapicheck
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 32Mi
  
  securityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
  
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true
  
  # Service Account para startupapicheck
  serviceAccount:
    create: true
    name: ""
    annotations:
      helm.sh/hook: post-install
      helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
      helm.sh/hook-weight: "-5"
    automountServiceAccountToken: true

# Configuración adicional para el controlador
extraArgs: []
extraEnv: []

# Configuración de volumes adicionales
volumes: []
volumeMounts: []

# Configuración de anotaciones y etiquetas para pods
podAnnotations: {}
podLabels: {}

# Configuración de disruption budget
podDisruptionBudget:
  enabled: false

# Configuración de feature gates
featureGates: ""

# Configuración de ACME solver
acmesolver:
  image:
    registry: quay.io
    repository: jetstack/cert-manager-acmesolver
    pullPolicy: IfNotPresent

# Auto-approver configuration
disableAutoApproval: false
approveSignerNames:
  - "issuers.cert-manager.io/*"
  - "clusterissuers.cert-manager.io/*"

# Liveness probe para el controlador
livenessProbe:
  enabled: true
  failureThreshold: 8
  initialDelaySeconds: 10
  periodSeconds: 10
  successThreshold: 1
  timeoutSeconds: 15
